BTEQ 16.20.00.07 (32-bit) Sat Jan 28 01:03:46 2023 PID: 18743714
 
+---------+---------+---------+---------+---------+---------+---------+----

.SESSIONS 4
+---------+---------+---------+---------+---------+---------+---------+----

LOGON tdtp01s2/usr_carga_desa,

 *** Logon successfully completed.
 *** 4 Sessions logged on.
 *** Teradata Database Release is 16.20.53.55                   
 *** Teradata Database Version is 16.20.53.55                     
 *** Transaction Semantics are BTET.
 *** Session Character Set Name is 'ASCII'.
 
 *** Total elapsed time was 1 second.
 
+---------+---------+---------+---------+---------+---------+---------+----

DATABASE bddwedqd;

 *** Ok, Session 4041981, Request 3, Statement# 1
 *** New default database accepted. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----

 .SET DEFAULTS
+---------+---------+---------+---------+---------+---------+---------+----
 .SET TITLEDASHES OFF
+---------+---------+---------+---------+---------+---------+---------+----
 .SET WIDTH 1000
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


SEL CURRENT_TIMESTAMP;

 *** Ok, Session 4041981, Request 4, Statement# 1
 *** Query completed. One row found. One column returned. 
 *** Total elapsed time was 1 second.

            Current TimeStamp(6)
2023-01-28 00:48:53.110000-05:00

+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


SELECT 1 FROM  dbc.TablesV WHERE databasename = 'bddwestgd' AND TableName = 'tmp093168_kpi_formularios';

 *** Ok, Session 4041981, Request 5, Statement# 1
 *** Query completed. One row found. One column returned. 
 *** Total elapsed time was 1 second.

   1
   1

+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF activitycount = 0 THEN .GOTO ok
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
DROP TABLE bddwestgd.tmp093168_kpi_formularios;

 *** Ok, Session 4041981, Request 6, Statement# 1
 *** Table has been dropped. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.label ok;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


CREATE MULTISET TABLE bddwestgd.tmp093168_kpi_formularios
(
cod_form    varchar(4)
) UNIQUE PRIMARY INDEX (cod_form);

 *** Ok, Session 4041981, Request 7, Statement# 1
 *** Table has been created. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IMPORT VARTEXT '|'  FILE = '/work1/teradata/dat/093168/093168_KPI_ListFormularios.txt'
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.QUIET ON
 *** Use '.QUIET OFF' to resume output.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.REPEAT *
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
USING 
(
cod_form       varchar(4)
)
INSERT INTO  bddwestgd.tmp093168_kpi_formularios VALUES
(
:cod_form
);
 *** Starting record 1 at Sat Jan 28 01:03:47 2023
 
 *** Warning: Out of data. 
 *** Finished at record 29 at Sat Jan 28 01:03:47 2023
 *** Total number of statements: 29,  Accepted : 29,  Rejected : 0 
 
 *** Total elapsed time was 1 second.
 
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.QUIET OFF;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


SEL CURRENT_TIMESTAMP;

 *** Ok, Session 4041981, Request 16, Statement# 1
 *** Query completed. One row found. One column returned. 
 *** Total elapsed time was 1 second.

            Current TimeStamp(6)
2023-01-28 00:48:53.550000-05:00

+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



------------Genera Detalle Presentaciones Teradata-------------------------------

SELECT 1 FROM  dbc.TablesV WHERE databasename = 'bddwestgd' AND TableName = 'tmp093168_kpi36_detafo_tr';

 *** Ok, Session 4041981, Request 17, Statement# 1
 *** Query completed. No rows found. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF activitycount = 0 THEN .GOTO ok
.GOTO ok
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

DROP TABLE bddwestgd.tmp093168_kpi36_detafo_tr;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.label ok;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

CREATE MULTISET TABLE bddwestgd.tmp093168_kpi36_detafo_tr
AS
(
select
    num_docidenti,
    num_nabono,
    cod_formul,
    num_orden,    
    fec_presenta,
    num_periodo
from desa_dwh_data.t2782djcab
where fec_presenta >= CAST('2022-10-01' AS DATE FORMAT 'YYYY-MM-DD')
and cod_formul in (SELECT CAST(cod_form as integer) FROM bddwestgd.tmp093168_kpi_formularios)
and num_periodo between 202201 and 202213
)WITH DATA PRIMARY INDEX (num_nabono,cod_formul,num_orden);

 *** Ok, Session 4041981, Request 18, Statement# 1
 *** Table has been created. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

------------Genera Detalle Presentaciones MongoDB-------------------------------

SELECT 1 FROM  dbc.TablesV WHERE databasename = 'bddwestgd' AND TableName = 'tmp093168_kpi36_detafo_mdb';

 *** Ok, Session 4041981, Request 19, Statement# 1
 *** Query completed. No rows found. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF activitycount = 0 THEN .GOTO ok
.GOTO ok
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

DROP TABLE bddwestgd.tmp093168_kpi36_detafo_mdb;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.label ok;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

CREATE MULTISET TABLE bddwestgd.tmp093168_kpi36_detafo_mdb
AS
(
select 
    numRuc,
    numOperacion,
    codFormulario,
    numOrden,    
    cast(substr(trim(fecPresentacion),1,10) as date format 'yyyy-mm-dd') as fec_presenta,
    perPeriodo
 from bddwestgd.present_mongo2 
 where fec_presenta >= CAST('2022-10-01' AS DATE FORMAT 'YYYY-MM-DD')
 and codFormulario in (SELECT cast(cod_form as integer) FROM bddwestgd.tmp093168_kpi_formularios)
 and perPeriodo between '202201' and '202213'

)
WITH DATA PRIMARY INDEX (numOperacion,codFormulario,numOrden);

 *** Ok, Session 4041981, Request 20, Statement# 1
 *** Table has been created. 
 *** Total elapsed time was 3 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/*************************************************************************************/

/*======================================================================================*/
/************************Conteo para insercion en DETKPI ********************************/

---------1. Conteo transaccional

SELECT 1 FROM  dbc.TablesV WHERE databasename = 'bddwestgd' AND TableName = 'tmp093168_kpigr36_obs_cnorigen';

 *** Ok, Session 4041981, Request 21, Statement# 1
 *** Query completed. No rows found. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF activitycount = 0 THEN .GOTO ok
.GOTO ok
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
DROP TABLE bddwestgd.tmp093168_kpigr36_obs_cnorigen;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF ERRORCODE <> 0 THEN .GOTO error_shell;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.label ok;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

CREATE MULTISET TABLE bddwestgd.tmp093168_kpigr36_obs_cnorigen AS
(
    SELECT count(num_orden) as cant_comp_origen
    FROM bddwestgd.tmp093168_kpi36_detafo_tr
) WITH DATA NO PRIMARY INDEX;

 *** Ok, Session 4041981, Request 22, Statement# 1
 *** Table has been created. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

---------2. Conteo en FVirtual


SELECT 1 FROM  dbc.TablesV WHERE databasename = 'bddwestgd' AND TableName = 'tmp093168_kpigr36_cndestino1';

 *** Ok, Session 4041981, Request 23, Statement# 1
 *** Query completed. No rows found. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF activitycount = 0 THEN .GOTO ok
.GOTO ok
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
DROP TABLE bddwestgd.tmp093168_kpigr36_cndestino1;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.IF ERRORCODE <> 0 THEN .GOTO error_shell;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
.label ok;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

CREATE MULTISET TABLE bddwestgd.tmp093168_kpigr36_cndestino1 AS
(
    SELECT count(numOrden) as cant_comp_destino1
    FROM bddwestgd.tmp093168_kpi36_detafo_mdb
) WITH DATA NO PRIMARY INDEX;

 *** Ok, Session 4041981, Request 24, Statement# 1
 *** Table has been created. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

.IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/********************INSERT EN TABLA FINAL***********************************/
    
    DELETE FROM bddwedqd.T11908DETKPITRIBINT 
    WHERE COD_KPI='K036012022'  AND FEC_CARGA=CURRENT_DATE;

 *** Ok, Session 4041981, Request 25, Statement# 1
 *** Delete completed. One row removed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
    
    .IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
    
    INSERT INTO bddwedqd.T11908DETKPITRIBINT 
    (COD_PER,IND_PRESDJ,COD_KPI,FEC_CARGA,CNT_REGORIGEN,CNT_REGIDESTINO)
    SELECT  '2022',
            '99',
            'K036012022',
            CURRENT_DATE,
            (SELECT cant_comp_origen FROM bddwestgd.tmp093168_kpigr36_obs_cnorigen ),
            (SELECT cant_comp_destino1 FROM bddwestgd.tmp093168_kpigr36_cndestino1 );

 *** Ok, Session 4041981, Request 26, Statement# 1
 *** Insert completed. One row added. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
    
    .IF ERRORCODE <> 0 THEN .GOTO error_shell;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/******************************************************************************/

SEL CURRENT_TIMESTAMP;

 *** Ok, Session 4041981, Request 27, Statement# 1
 *** Query completed. One row found. One column returned. 
 *** Total elapsed time was 1 second.

            Current TimeStamp(6)
2023-01-28 00:48:57.100000-05:00

+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/**************************************************************/

DROP TABLE bddwestgd.tmp093168_kpi36_detafo_tr;

 *** Ok, Session 4041981, Request 28, Statement# 1
 *** Table has been dropped. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
DROP TABLE bddwestgd.tmp093168_kpi36_detafo_mdb;

 *** Ok, Session 4041981, Request 29, Statement# 1
 *** Table has been dropped. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

DROP TABLE bddwestgd.tmp093168_kpigr36_obs_cnorigen;

 *** Ok, Session 4041981, Request 30, Statement# 1
 *** Table has been dropped. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
DROP TABLE bddwestgd.tmp093168_kpigr36_cndestino1;

 *** Ok, Session 4041981, Request 31, Statement# 1
 *** Table has been dropped. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/**************************************************************/

SEL CURRENT_TIMESTAMP;

 *** Ok, Session 4041981, Request 32, Statement# 1
 *** Query completed. One row found. One column returned. 
 *** Total elapsed time was 1 second.

            Current TimeStamp(6)
2023-01-28 00:48:57.620000-05:00

+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

LOGOFF;
 *** You are now logged off from the DBC.
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
QUIT 0;
 *** Exiting BTEQ...
 *** RC (return code) = 0 
  ***********************************************
  ***  J093168_KPIGRP36   ***
  ***            TERMINO PROCESO OK           ***
  ***********************************************
